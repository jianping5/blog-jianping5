<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>sync.Map | Jianping5</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="favicon.jpg">
    <meta name="description" content="https://cs.opensource.google/go/go/+/refs/tags/go1.20.6:src/sync/map.go

type Map struct {
        mu Mutex

        // read contains the portion of the map&#39;s contents that are safe for
 ...">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.1d43d066.css" as="style"><link rel="preload" href="/assets/js/app.dedcbd64.js" as="script"><link rel="preload" href="/assets/js/7.46feb9c9.js" as="script"><link rel="preload" href="/assets/js/3.260c5242.js" as="script"><link rel="preload" href="/assets/js/9.e308b6f3.js" as="script"><link rel="prefetch" href="/assets/js/10.1043b50d.js"><link rel="prefetch" href="/assets/js/11.7e81a20d.js"><link rel="prefetch" href="/assets/js/12.dcce51f3.js"><link rel="prefetch" href="/assets/js/13.15844d91.js"><link rel="prefetch" href="/assets/js/14.34763e3f.js"><link rel="prefetch" href="/assets/js/15.f93e8f42.js"><link rel="prefetch" href="/assets/js/16.cbc88fd3.js"><link rel="prefetch" href="/assets/js/17.3b82dd97.js"><link rel="prefetch" href="/assets/js/18.0f20f1d7.js"><link rel="prefetch" href="/assets/js/19.cf564c57.js"><link rel="prefetch" href="/assets/js/20.39afcc67.js"><link rel="prefetch" href="/assets/js/21.72e5e426.js"><link rel="prefetch" href="/assets/js/22.eedae219.js"><link rel="prefetch" href="/assets/js/23.607d9870.js"><link rel="prefetch" href="/assets/js/4.3c197d26.js"><link rel="prefetch" href="/assets/js/5.36162a2a.js"><link rel="prefetch" href="/assets/js/6.a738bc2a.js"><link rel="prefetch" href="/assets/js/8.9f1a5e77.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.3c955fbe.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1d43d066.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">Jianping5 </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/post/" class="nav-link router-link-active">Blog</a></li><li class="nav-item"><a href="/about/" class="nav-link">About</a></li><li class="nav-item"><a href="https://github.com/jianping5" target="_blank" rel="noopener noreferrer" class="nav-link external">Github</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">Jianping5 </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/post/" class="nav-link router-link-active">Blog</a></li><li class="mobile-nav-item"><a href="/about/" class="nav-link">About</a></li><li class="mobile-nav-item"><a href="https://github.com/jianping5" target="_blank" rel="noopener noreferrer" class="nav-link external">Github</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        sync.Map
      </h1> <div class="post-meta"><div itemprop="publisher author" itemtype="http://schema.org/Person" itemscope="itemscope" class="post-meta-author"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-navigation"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg> <span itemprop="name">jianping5</span> <span itemprop="address"> Â  in ShangHai</span></div> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2023-07-22T00:00:00.000Z">
      Sat Jul 22 2023
    </time></div> <!----></div></header> <div itemprop="articleBody" class="content__default"><blockquote><p>https://cs.opensource.google/go/go/+/refs/tags/go1.20.6:src/sync/map.go</p></blockquote> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> Map <span class="token keyword">struct</span> <span class="token punctuation">{</span>
        mu Mutex

        <span class="token comment">// read contains the portion of the map's contents that are safe for</span>
        <span class="token comment">// concurrent access (with or without mu held).</span>
        <span class="token comment">//</span>
        <span class="token comment">// The read field itself is always safe to load, but must only be stored with</span>
        <span class="token comment">// mu held.</span>
        <span class="token comment">//</span>
        <span class="token comment">// Entries stored in read may be updated concurrently without mu, but updating</span>
        <span class="token comment">// a previously-expunged entry requires that the entry be copied to the dirty</span>
        <span class="token comment">// map and unexpunged with mu held.</span>
        read atomic<span class="token punctuation">.</span>Pointer<span class="token punctuation">[</span>readOnly<span class="token punctuation">]</span>

        <span class="token comment">// dirty contains the portion of the map's contents that require mu to be</span>
        <span class="token comment">// held. To ensure that the dirty map can be promoted to the read map quickly,</span>
        <span class="token comment">// it also includes all of the non-expunged entries in the read map.</span>
        <span class="token comment">//</span>
        <span class="token comment">// Expunged entries are not stored in the dirty map. An expunged entry in the</span>
        <span class="token comment">// clean map must be unexpunged and added to the dirty map before a new value</span>
        <span class="token comment">// can be stored to it.</span>
        <span class="token comment">//</span>
        <span class="token comment">// If the dirty map is nil, the next write to the map will initialize it by</span>
        <span class="token comment">// making a shallow copy of the clean map, omitting stale entries.</span>
        dirty <span class="token keyword">map</span><span class="token punctuation">[</span>any<span class="token punctuation">]</span><span class="token operator">*</span>entry

        <span class="token comment">// misses counts the number of loads since the read map was last updated that</span>
        <span class="token comment">// needed to lock mu to determine whether the key was present.</span>
        <span class="token comment">//</span>
        <span class="token comment">// Once enough misses have occurred to cover the cost of copying the dirty</span>
        <span class="token comment">// map, the dirty map will be promoted to the read map (in the unamended</span>
        <span class="token comment">// state) and the next store to the map will make a new dirty copy.</span>
        misses <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token comment">// readOnly is an immutable struct stored atomically in the Map.read field.</span>
<span class="token keyword">type</span> readOnly <span class="token keyword">struct</span> <span class="token punctuation">{</span>
        m       <span class="token keyword">map</span><span class="token punctuation">[</span>any<span class="token punctuation">]</span><span class="token operator">*</span>entry
        amended <span class="token builtin">bool</span> <span class="token comment">// true if the dirty map contains some key not in m.</span>
<span class="token punctuation">}</span>

<span class="token comment">// expunged is an arbitrary pointer that marks entries which have been deleted</span>
<span class="token comment">// from the dirty map.</span>
<span class="token keyword">var</span> expunged <span class="token operator">=</span> <span class="token function">new</span><span class="token punctuation">(</span>any<span class="token punctuation">)</span>

<span class="token comment">// An entry is a slot in the map corresponding to a particular key.</span>
<span class="token keyword">type</span> entry <span class="token keyword">struct</span> <span class="token punctuation">{</span>
        <span class="token comment">// p points to the interface{} value stored for the entry.</span>
        <span class="token comment">//</span>
        <span class="token comment">// If p == nil, the entry has been deleted, and either m.dirty == nil or</span>
        <span class="token comment">// m.dirty[key] is e.</span>
        <span class="token comment">//</span>
        <span class="token comment">// If p == expunged, the entry has been deleted, m.dirty != nil, and the entry</span>
        <span class="token comment">// is missing from m.dirty.</span>
        <span class="token comment">//</span>
        <span class="token comment">// Otherwise, the entry is valid and recorded in m.read.m[key] and, if m.dirty</span>
        <span class="token comment">// != nil, in m.dirty[key].</span>
        <span class="token comment">//</span>
        <span class="token comment">// An entry can be deleted by atomic replacement with nil: when m.dirty is</span>
        <span class="token comment">// next created, it will atomically replace nil with expunged and leave</span>
        <span class="token comment">// m.dirty[key] unset.</span>
        <span class="token comment">//</span>
        <span class="token comment">// An entry's associated value can be updated by atomic replacement, provided</span>
        <span class="token comment">// p != expunged. If p == expunged, an entry's associated value can be updated</span>
        <span class="token comment">// only after first setting m.dirty[key] = e so that lookups using the dirty</span>
        <span class="token comment">// map find the entry.</span>
        p atomic<span class="token punctuation">.</span>Pointer<span class="token punctuation">[</span>any<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="load-æ¥è¯¢"><a href="#load-æ¥è¯¢" class="header-anchor">#</a> Loadï¼æ¥è¯¢</h2> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token comment">// Load returns the value stored in the map for a key, or nil if no</span>
<span class="token comment">// value is present.</span>
<span class="token comment">// The ok result indicates whether value was found in the map.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Map<span class="token punctuation">)</span> <span class="token function">Load</span><span class="token punctuation">(</span>key any<span class="token punctuation">)</span> <span class="token punctuation">(</span>value any<span class="token punctuation">,</span> ok <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        read <span class="token operator">:=</span> m<span class="token punctuation">.</span><span class="token function">loadReadOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        e<span class="token punctuation">,</span> ok <span class="token operator">:=</span> read<span class="token punctuation">.</span>m<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token operator">&amp;&amp;</span> read<span class="token punctuation">.</span>amended <span class="token punctuation">{</span>
                m<span class="token punctuation">.</span>mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// Avoid reporting a spurious miss if m.dirty got promoted while we were</span>
                <span class="token comment">// blocked on m.mu. (If further loads of the same key will not miss, it's</span>
                <span class="token comment">// not worth copying the dirty map for this key.)</span>
                read <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">loadReadOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                e<span class="token punctuation">,</span> ok <span class="token operator">=</span> read<span class="token punctuation">.</span>m<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
                <span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token operator">&amp;&amp;</span> read<span class="token punctuation">.</span>amended <span class="token punctuation">{</span>
                        e<span class="token punctuation">,</span> ok <span class="token operator">=</span> m<span class="token punctuation">.</span>dirty<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
                        <span class="token comment">// Regardless of whether the entry was present, record a miss: this key</span>
                        <span class="token comment">// will take the slow path until the dirty map is promoted to the read</span>
                        <span class="token comment">// map.</span>
                        m<span class="token punctuation">.</span><span class="token function">missLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                m<span class="token punctuation">.</span>mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> e<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Map<span class="token punctuation">)</span> <span class="token function">loadReadOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span> readOnly <span class="token punctuation">{</span>
        <span class="token keyword">if</span> p <span class="token operator">:=</span> m<span class="token punctuation">.</span>read<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> p <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token operator">*</span>p
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> readOnly<span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Map<span class="token punctuation">)</span> <span class="token function">missLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        m<span class="token punctuation">.</span>misses<span class="token operator">++</span>
        <span class="token keyword">if</span> m<span class="token punctuation">.</span>misses <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>dirty<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        m<span class="token punctuation">.</span>read<span class="token punctuation">.</span><span class="token function">Store</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>readOnly<span class="token punctuation">{</span>m<span class="token punctuation">:</span> m<span class="token punctuation">.</span>dirty<span class="token punctuation">}</span><span class="token punctuation">)</span>
        m<span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token boolean">nil</span>
        m<span class="token punctuation">.</span>misses <span class="token operator">=</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Load æµç¨ï¼</p> <ol><li>è¯»åæ¶åä» read ä¸­è¯»åï¼è¥ä¸å­å¨ä¸ amended ä¸º true æ¶ï¼åå éï¼åæ¬¡è¯»å readã</li></ol> <blockquote><p>ä¸ºä»ä¹è¦åæ¬¡è¯»å read å¢ï¼å ä¸ºåé¢çå¤æ­ä¸æ¯åå­æä½ï¼å¯è½å½æ¶ dirty æ­£å¨æåä¸º readï¼é¿åèåç missï¼æä»¥éè¦å éåæ¬¡è¯»å readãä¹æ¯ä¸ºäºé¿åä¸å¼å¾ç dirty æ·è´ï¼æé«æç</p></blockquote> <ol><li>è¥åæ¬¡è¯»åä¹ä¸å­å¨ä¸ amended ä¸º trueï¼åä» dirty ä¸­è·åã</li> <li>æ è®º dirty ä¸­æ¯å¦å­å¨ï¼é½éè¦è®°å½è¿ä¸ª missï¼å¢å  misses å­æ®µï¼è¥é¿åº¦å¤§äºç­äº dirty çé¿åº¦ï¼åå° dirty èµå¼ç» readï¼å¹¶å° dirty å missed ç½®ç©º</li></ol> <p><img src="/assets/img/1.693f2e15.png" alt="1.png"></p> <h2 id="store-æ°å¢-ä¿®æ¹"><a href="#store-æ°å¢-ä¿®æ¹" class="header-anchor">#</a> Storeï¼æ°å¢/ä¿®æ¹</h2> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token comment">// Store sets the value for a key.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Map<span class="token punctuation">)</span> <span class="token function">Store</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value any<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token boolean">_</span><span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">Swap</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Swap swaps the value for a key and returns the previous value if any.</span>
<span class="token comment">// The loaded result reports whether the key was present.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Map<span class="token punctuation">)</span> <span class="token function">Swap</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value any<span class="token punctuation">)</span> <span class="token punctuation">(</span>previous any<span class="token punctuation">,</span> loaded <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        read <span class="token operator">:=</span> m<span class="token punctuation">.</span><span class="token function">loadReadOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> e<span class="token punctuation">,</span> ok <span class="token operator">:=</span> read<span class="token punctuation">.</span>m<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>
                <span class="token keyword">if</span> v<span class="token punctuation">,</span> ok <span class="token operator">:=</span> e<span class="token punctuation">.</span><span class="token function">trySwap</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>
                        <span class="token keyword">if</span> v <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                                <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">false</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword">return</span> <span class="token operator">*</span>v<span class="token punctuation">,</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        m<span class="token punctuation">.</span>mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        read <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">loadReadOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> e<span class="token punctuation">,</span> ok <span class="token operator">:=</span> read<span class="token punctuation">.</span>m<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>
                <span class="token keyword">if</span> e<span class="token punctuation">.</span><span class="token function">unexpungeLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">// The entry was previously expunged, which implies that there is a</span>
                        <span class="token comment">// non-nil dirty map and this entry is not in it.</span>
                        m<span class="token punctuation">.</span>dirty<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> e
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> v <span class="token operator">:=</span> e<span class="token punctuation">.</span><span class="token function">swapLocked</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> v <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                        loaded <span class="token operator">=</span> <span class="token boolean">true</span>
                        previous <span class="token operator">=</span> <span class="token operator">*</span>v
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> e<span class="token punctuation">,</span> ok <span class="token operator">:=</span> m<span class="token punctuation">.</span>dirty<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>
                <span class="token keyword">if</span> v <span class="token operator">:=</span> e<span class="token punctuation">.</span><span class="token function">swapLocked</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> v <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                        loaded <span class="token operator">=</span> <span class="token boolean">true</span>
                        previous <span class="token operator">=</span> <span class="token operator">*</span>v
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token operator">!</span>read<span class="token punctuation">.</span>amended <span class="token punctuation">{</span>
                        <span class="token comment">// We're adding the first new key to the dirty map.</span>
                        <span class="token comment">// Make sure it is allocated and mark the read-only map as incomplete.</span>
                        m<span class="token punctuation">.</span><span class="token function">dirtyLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        m<span class="token punctuation">.</span>read<span class="token punctuation">.</span><span class="token function">Store</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>readOnly<span class="token punctuation">{</span>m<span class="token punctuation">:</span> read<span class="token punctuation">.</span>m<span class="token punctuation">,</span> amended<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                m<span class="token punctuation">.</span>dirty<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">newEntry</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        m<span class="token punctuation">.</span>mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> previous<span class="token punctuation">,</span> loaded
<span class="token punctuation">}</span>

<span class="token comment">// trySwap swaps a value if the entry has not been expunged.</span>
<span class="token comment">//</span>
<span class="token comment">// If the entry is expunged, trySwap returns false and leaves the entry</span>
<span class="token comment">// unchanged.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>e <span class="token operator">*</span>entry<span class="token punctuation">)</span> <span class="token function">trySwap</span><span class="token punctuation">(</span>i <span class="token operator">*</span>any<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>any<span class="token punctuation">,</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">{</span>
                p <span class="token operator">:=</span> e<span class="token punctuation">.</span>p<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> p <span class="token operator">==</span> expunged <span class="token punctuation">{</span>
                        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">false</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> e<span class="token punctuation">.</span>p<span class="token punctuation">.</span><span class="token function">CompareAndSwap</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">return</span> p<span class="token punctuation">,</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// CompareAndSwap swaps the old and new values for key</span>
<span class="token comment">// if the value stored in the map is equal to old.</span>
<span class="token comment">// The old value must be of a comparable type.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Map<span class="token punctuation">)</span> <span class="token function">CompareAndSwap</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> old<span class="token punctuation">,</span> <span class="token builtin">new</span> any<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
        read <span class="token operator">:=</span> m<span class="token punctuation">.</span><span class="token function">loadReadOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> e<span class="token punctuation">,</span> ok <span class="token operator">:=</span> read<span class="token punctuation">.</span>m<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>
                <span class="token keyword">return</span> e<span class="token punctuation">.</span><span class="token function">tryCompareAndSwap</span><span class="token punctuation">(</span>old<span class="token punctuation">,</span> <span class="token builtin">new</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token operator">!</span>read<span class="token punctuation">.</span>amended <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span> <span class="token comment">// No existing value for key.</span>
        <span class="token punctuation">}</span>

        m<span class="token punctuation">.</span>mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">defer</span> m<span class="token punctuation">.</span>mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        read <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">loadReadOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        swapped <span class="token operator">:=</span> <span class="token boolean">false</span>
        <span class="token keyword">if</span> e<span class="token punctuation">,</span> ok <span class="token operator">:=</span> read<span class="token punctuation">.</span>m<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>
                swapped <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">tryCompareAndSwap</span><span class="token punctuation">(</span>old<span class="token punctuation">,</span> <span class="token builtin">new</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> e<span class="token punctuation">,</span> ok <span class="token operator">:=</span> m<span class="token punctuation">.</span>dirty<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>
                swapped <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">tryCompareAndSwap</span><span class="token punctuation">(</span>old<span class="token punctuation">,</span> <span class="token builtin">new</span><span class="token punctuation">)</span>
                <span class="token comment">// We needed to lock mu in order to load the entry for key,</span>
                <span class="token comment">// and the operation didn't change the set of keys in the map</span>
                <span class="token comment">// (so it would be made more efficient by promoting the dirty</span>
                <span class="token comment">// map to read-only).</span>
                <span class="token comment">// Count it as a miss so that we will eventually switch to the</span>
                <span class="token comment">// more efficient steady state.</span>
                m<span class="token punctuation">.</span><span class="token function">missLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> swapped
<span class="token punctuation">}</span>

<span class="token comment">// tryCompareAndSwap compare the entry with the given old value and swaps</span>
<span class="token comment">// it with a new value if the entry is equal to the old value, and the entry</span>
<span class="token comment">// has not been expunged.</span>
<span class="token comment">//</span>
<span class="token comment">// If the entry is expunged, tryCompareAndSwap returns false and leaves</span>
<span class="token comment">// the entry unchanged.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>e <span class="token operator">*</span>entry<span class="token punctuation">)</span> <span class="token function">tryCompareAndSwap</span><span class="token punctuation">(</span>old<span class="token punctuation">,</span> <span class="token builtin">new</span> any<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
        p <span class="token operator">:=</span> e<span class="token punctuation">.</span>p<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> p <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token operator">||</span> p <span class="token operator">==</span> expunged <span class="token operator">||</span> <span class="token operator">*</span>p <span class="token operator">!=</span> old <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Copy the interface after the first load to make this method more amenable</span>
        <span class="token comment">// to escape analysis: if the comparison fails from the start, we shouldn't</span>
        <span class="token comment">// bother heap-allocating an interface value to store.</span>
        nc <span class="token operator">:=</span> <span class="token builtin">new</span>
        <span class="token keyword">for</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> e<span class="token punctuation">.</span>p<span class="token punctuation">.</span><span class="token function">CompareAndSwap</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token operator">&amp;</span>nc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">return</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span>
                p <span class="token operator">=</span> e<span class="token punctuation">.</span>p<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> p <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token operator">||</span> p <span class="token operator">==</span> expunged <span class="token operator">||</span> <span class="token operator">*</span>p <span class="token operator">!=</span> old <span class="token punctuation">{</span>
                        <span class="token keyword">return</span> <span class="token boolean">false</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// unexpungeLocked ensures that the entry is not marked as expunged.</span>
<span class="token comment">//</span>
<span class="token comment">// If the entry was previously expunged, it must be added to the dirty map</span>
<span class="token comment">// before m.mu is unlocked.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>e <span class="token operator">*</span>entry<span class="token punctuation">)</span> <span class="token function">unexpungeLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>wasExpunged <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> e<span class="token punctuation">.</span>p<span class="token punctuation">.</span><span class="token function">CompareAndSwap</span><span class="token punctuation">(</span>expunged<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// swapLocked unconditionally swaps a value into the entry.</span>
<span class="token comment">//</span>
<span class="token comment">// The entry must be known not to be expunged.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>e <span class="token operator">*</span>entry<span class="token punctuation">)</span> <span class="token function">swapLocked</span><span class="token punctuation">(</span>i <span class="token operator">*</span>any<span class="token punctuation">)</span> <span class="token operator">*</span>any <span class="token punctuation">{</span>
        <span class="token keyword">return</span> e<span class="token punctuation">.</span>p<span class="token punctuation">.</span><span class="token function">Swap</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// å° read ä¸­æªå é¤çæ°æ®å å¥å° dirty ä¸­</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Map<span class="token punctuation">)</span> <span class="token function">dirtyLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> m<span class="token punctuation">.</span>dirty <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span>
        <span class="token punctuation">}</span>

        read <span class="token operator">:=</span> m<span class="token punctuation">.</span><span class="token function">loadReadOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        m<span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span>any<span class="token punctuation">]</span><span class="token operator">*</span>entry<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>read<span class="token punctuation">.</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment">// éå read</span>
        <span class="token keyword">for</span> k<span class="token punctuation">,</span> e <span class="token operator">:=</span> <span class="token keyword">range</span> read<span class="token punctuation">.</span>m <span class="token punctuation">{</span>
                <span class="token comment">// éè¿æ­¤æ¬¡æä½ï¼dirty ä¸­çåç´ é½æ¯æªè¢«å é¤çï¼å¯è§æ è®°ä¸º expunged çåç´ ä¸å¨ dirty ä¸­ï¼ï¼ï¼</span>
                <span class="token keyword">if</span> <span class="token operator">!</span>e<span class="token punctuation">.</span><span class="token function">tryExpungeLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        m<span class="token punctuation">.</span>dirty<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> e
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// å¤æ­ entry æ¯å¦è¢«æ è®°å é¤ï¼å¹¶ä¸å°æ è®°ä¸º nil ç entry æ´æ°æ è®°ä¸º expunged</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>e <span class="token operator">*</span>entry<span class="token punctuation">)</span> <span class="token function">tryExpungeLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>isExpunged <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        p <span class="token operator">:=</span> e<span class="token punctuation">.</span>p<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> p <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> e<span class="token punctuation">.</span>p<span class="token punctuation">.</span><span class="token function">CompareAndSwap</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">,</span> expunged<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">return</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span>
                p <span class="token operator">=</span> e<span class="token punctuation">.</span>p<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> p <span class="token operator">==</span> expunged
<span class="token punctuation">}</span>
</code></pre></div><p>Store æµç¨ï¼</p> <ol><li>è¥ read ä¸­å­å¨è¯¥å¼ï¼åå°è¯æ´æ°ï¼è¥è¯¥å¼æªè¢«æ è®° expungedï¼åè¿è¡ CompareAndSwap</li> <li>è¥ä¸å­å¨ï¼åå éåæ¬¡å¤æ­æ¯å¦å­å¨ï¼è¥ read ä¸­å­å¨ï¼
<ol><li>åéè¿ e.unexpungeLocked() å¤æ­å¶æ¯å¦è¢«æ è®°ä¸º expungedï¼è¥æ¯ï¼åå°å¶æ·»å å° dirty ä¸­ï¼å ä¸ºå®è¢«æ è®°ä¸º expungedï¼è¯´æå¨ dirty ä¸­ä¸å­å¨ï¼</li> <li>è¥ä¸æ¯ï¼ååæ¬¡è¿è¡ Swap()ï¼å°è¯æ´æ°</li></ol></li> <li>è¥ read ä¸­ä¸å­å¨ï¼åå¤æ­ drity ä¸­æ¯å¦å­å¨ï¼è¥ drity ä¸­å­å¨ï¼
<ol><li>ååæ¬¡è¿è¡ Swap()ï¼å°è¯æ´æ°</li></ol></li> <li>è¥ drity ä¸­ä¹ä¸å­å¨ï¼
<ol><li>è¥ dirty ä¸åå« read ä¸­ä¸å­å¨ç keyï¼åè§¦åä¸æ¬¡ dirty å·æ°ï¼å° read ä¸­æªå é¤çæ°æ®å å¥å° dirty ä¸­ï¼ï¼å ä¸ºå½ read éç½®çæ¶åï¼dirty å·²ç»ç½®ä¸º nil äºï¼å¨è¿ä¸ªè¿ç¨ä¸­è¿å°æ è®°ä¸º nil ç entry æ´æ°æ è®°ä¸º expunged</li> <li>è¥ dirty ä¸­åå« read ä¸­ä¸å­å¨ç keyï¼åå°æ°çé®å¼å¯¹åå¥ dirty ä¸­</li></ol></li></ol> <p><img src="/assets/img/2.224e45c9.png" alt="2.png"></p> <h2 id="delete-å é¤"><a href="#delete-å é¤" class="header-anchor">#</a> Deleteï¼å é¤</h2> <div class="language-Go extra-class"><pre class="language-go"><code><span class="token comment">// Delete deletes the value for a key.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Map<span class="token punctuation">)</span> <span class="token function">Delete</span><span class="token punctuation">(</span>key any<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        m<span class="token punctuation">.</span><span class="token function">LoadAndDelete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// LoadAndDelete deletes the value for a key, returning the previous value if any.</span>
<span class="token comment">// The loaded result reports whether the key was present.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Map<span class="token punctuation">)</span> <span class="token function">LoadAndDelete</span><span class="token punctuation">(</span>key any<span class="token punctuation">)</span> <span class="token punctuation">(</span>value any<span class="token punctuation">,</span> loaded <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        read <span class="token operator">:=</span> m<span class="token punctuation">.</span><span class="token function">loadReadOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        e<span class="token punctuation">,</span> ok <span class="token operator">:=</span> read<span class="token punctuation">.</span>m<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token operator">&amp;&amp;</span> read<span class="token punctuation">.</span>amended <span class="token punctuation">{</span>
                m<span class="token punctuation">.</span>mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                read <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">loadReadOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                e<span class="token punctuation">,</span> ok <span class="token operator">=</span> read<span class="token punctuation">.</span>m<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
                <span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token operator">&amp;&amp;</span> read<span class="token punctuation">.</span>amended <span class="token punctuation">{</span>
                        e<span class="token punctuation">,</span> ok <span class="token operator">=</span> m<span class="token punctuation">.</span>dirty<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
                        <span class="token function">delete</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>dirty<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
                        <span class="token comment">// Regardless of whether the entry was present, record a miss: this key</span>
                        <span class="token comment">// will take the slow path until the dirty map is promoted to the read</span>
                        <span class="token comment">// map.</span>
                        m<span class="token punctuation">.</span><span class="token function">missLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                m<span class="token punctuation">.</span>mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> ok <span class="token punctuation">{</span>
                <span class="token keyword">return</span> e<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Delete æµç¨ï¼</p> <ol><li>åå¤æ­ read ä¸­æ¯å¦å­å¨ï¼è¥ä¸å­å¨ï¼åå éåæ¬¡å¤æ­</li> <li>åæ¬¡å¤æ­è¿æ¯ä¸å­å¨ï¼åç´æ¥å é¤ dirty ä¸­çï¼å¹¶è®°å½ missï¼è¿è¡ m.missLocked()</li> <li>è¥ misses å­æ®µ å¤§äºç­äº drity çé¿åº¦ï¼åå° drity èµå¼ç» readï¼å¹¶å° dirty å misses ç½®ç©º</li> <li>è¥ read ä¸­å­å¨è¯¥ keyï¼å°è¿è¡ e.delete()ï¼éè¿å»¶è¿å é¤å¯¹ read ä¸­çå¼ååè¿è¡æ è®°ï¼</li></ol> <p>å° read ä¸­ç®æ  key å¯¹åºç value å¼ç½®ä¸º nilï¼<code>e.delete()</code>âå°<code>read=map[interface{}]*entry</code>ä¸­çå¼å*entry ç½®ä¸º nilï¼</p> <p><img src="/assets/img/3.5f2a7b4d.png" alt="3.png"></p> <h2 id="æ»ç»"><a href="#æ»ç»" class="header-anchor">#</a> æ»ç»</h2> <p>sync.Map æ¯éè¿åä½çä¸¤ä¸ªæ°æ®ç»æ(readãdirty)ï¼å®ç°æ§è½çæåã</p> <ol><li>ä¸ºäºæåæ§è½ï¼loadãdeleteãstore ç­æä½å°½éä½¿ç¨åªè¯»ç readï¼</li> <li>ä¸ºäºæé« read ç key å»ä¸­æ¦çï¼éç¨å¨æè°æ´ï¼å° dirty æ°æ®æåä¸º readï¼</li> <li>å¯¹äºæ°æ®çå é¤ï¼éç¨å»¶è¿æ è®°å é¤æ³ï¼<em>åªæå¨æå dirty çæ¶åæå é¤</em>ã</li></ol></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#load-æ¥è¯¢" title="Loadï¼æ¥è¯¢">Loadï¼æ¥è¯¢</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#store-æ°å¢-ä¿®æ¹" title="Storeï¼æ°å¢/ä¿®æ¹">Storeï¼æ°å¢/ä¿®æ¹</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#delete-å é¤" title="Deleteï¼å é¤">Deleteï¼å é¤</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#æ»ç»" title="æ»ç»">æ»ç»</a></div></div></div></div> <footer class="footer" data-v-3d9deeb8><div class="footer-left-wrap" data-v-3d9deeb8><ul class="contact" data-v-3d9deeb8><li class="contact-item" data-v-3d9deeb8><a href="https://github.com/jianping5" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-3d9deeb8><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-v-3d9deeb8><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-3d9deeb8></path></svg>
          
        </a></li><li class="contact-item" data-v-3d9deeb8><a href="mailto:jianping756@gmail.com" class="nav-link external" data-v-3d9deeb8><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail" data-v-3d9deeb8><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" data-v-3d9deeb8></path><polyline points="22,6 12,13 2,6" data-v-3d9deeb8></polyline></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-3d9deeb8><ul class="copyright" data-v-3d9deeb8><li class="copyright-item" data-v-3d9deeb8>jianping5 Â© 2023</li></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.dedcbd64.js" defer></script><script src="/assets/js/7.46feb9c9.js" defer></script><script src="/assets/js/3.260c5242.js" defer></script><script src="/assets/js/9.e308b6f3.js" defer></script>
  </body>
</html>
